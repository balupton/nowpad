(function(a){function c(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0}var b=a.diff_match_patch=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32};b.prototype.diff_main=function(a,b,c,d){typeof d=="undefined"&&(d=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+this.Diff_Timeout*1e3);if(a==null||b==null)throw Error("Null input. (diff_main)");if(a==b)return a?[[0,a]]:[];typeof c=="undefined"&&(c=!0);var e=c,f=this.diff_commonPrefix(a,b);c=a.substring(0,f),a=a.substring(f),b=b.substring(f),f=this.diff_commonSuffix(a,b);var g=a.substring(a.length-f);a=a.substring(0,a.length-f),b=b.substring(0,b.length-f),a=this.diff_compute_(a,b,e,d),c&&a.unshift([0,c]),g&&a.push([0,g]),this.diff_cleanupMerge(a);return a},b.prototype.diff_compute_=function(a,b,c,d){if(!a)return[[1,b]];if(!b)return[[-1,a]];var e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=e.indexOf(f);if(g!=-1){c=[[1,e.substring(0,g)],[0,f],[1,e.substring(g+f.length)]],a.length>b.length&&(c[0][0]=c[2][0]=-1);return c}if(f.length==1)return[[-1,a],[1,b]];if(e=this.diff_halfMatch_(a,b)){f=e[0],a=e[1],g=e[2],b=e[3],e=e[4],f=this.diff_main(f,g,c,d),c=this.diff_main(a,b,c,d);return f.concat([[0,e]],c)}return c&&a.length>100&&b.length>100?this.diff_lineMode_(a,b,d):this.diff_bisect_(a,b,d)},b.prototype.diff_lineMode_=function(a,b,c){var d=this.diff_linesToChars_(a,b);a=d[0],b=d[1],d=d[2],a=this.diff_bisect_(a,b,c),this.diff_charsToLines_(a,d),this.diff_cleanupSemantic(a),a.push([0,""]);for(var e=b=0,f=0,g=d="";b<a.length;){switch(a[b][0]){case 1:f++,g+=a[b][1];break;case-1:e++,d+=a[b][1];break;case 0:if(e>=1&&f>=1){d=this.diff_main(d,g,!1,c),a.splice(b-e-f,e+f),b=b-e-f;for(e=d.length-1;e>=0;e--)a.splice(b,0,d[e]);b+=d.length}e=f=0,g=d=""}b++}a.pop();return a},b.prototype.diff_bisect_=function(a,b,c){for(var d=a.length,e=b.length,f=Math.ceil((d+e)/2),g=f,h=2*f,i=Array(h),j=Array(h),k=0;k<h;k++)i[k]=-1,j[k]=-1;i[g+1]=0,j[g+1]=0,k=d-e;for(var l=k%2!=0,m=0,n=0,o=0,p=0,q=0;q<f;q++){if((new Date).getTime()>c)break;for(var r=-q+m;r<=q-n;r+=2){var s=g+r,t;t=r==-q||r!=q&&i[s-1]<i[s+1]?i[s+1]:i[s-1]+1;for(var u=t-r;t<d&&u<e&&a.charAt(t)==b.charAt(u);)t++,u++;i[s]=t;if(t>d)n+=2;else if(u>e)m+=2;else if(l){s=g+k-r;if(s>=0&&s<h&&j[s]!=-1){var v=d-j[s];if(t>=v)return this.diff_bisectSplit_(a,b,t,u,c)}}}for(r=-q+o;r<=q-p;r+=2){s=g+r,v=r==-q||r!=q&&j[s-1]<j[s+1]?j[s+1]:j[s-1]+1;for(t=v-r;v<d&&t<e&&a.charAt(d-v-1)==b.charAt(e-t-1);)v++,t++;j[s]=v;if(v>d)p+=2;else if(t>e)o+=2;else if(!l){s=g+k-r;if(s>=0&&s<h&&i[s]!=-1){t=i[s],u=g+t-s,v=d-v;if(t>=v)return this.diff_bisectSplit_(a,b,t,u,c)}}}}return[[-1,a],[1,b]]},b.prototype.diff_bisectSplit_=function(a,b,c,d,e){var f=a.substring(0,c),g=b.substring(0,d);a=a.substring(c),b=b.substring(d),f=this.diff_main(f,g,!1,e),e=this.diff_main(a,b,!1,e);return f.concat(e)},b.prototype.diff_linesToChars_=function(a,b){function c(a){for(var b="",c=0,f=-1,g=d.length;f<a.length-1;){f=a.indexOf("\n",c),f==-1&&(f=a.length-1);var h=a.substring(c,f+1);c=f+1,(e.hasOwnProperty?e.hasOwnProperty(h):e[h]!==undefined)?b+=String.fromCharCode(e[h]):(b+=String.fromCharCode(g),e[h]=g,d[g++]=h)}return b}var d=[],e={};d[0]="";var f=c(a),g=c(b);return[f,g,d]},b.prototype.diff_charsToLines_=function(a,b){for(var c=0;c<a.length;c++){for(var d=a[c][1],e=[],f=0;f<d.length;f++)e[f]=b[d.charCodeAt(f)];a[c][1]=e.join("")}},b.prototype.diff_commonPrefix=function(a,b){if(!a||!b||a.charAt(0)!=b.charAt(0))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;c<e;)a.substring(f,e)==b.substring(f,e)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e},b.prototype.diff_commonSuffix=function(a,b){if(!a||!b||a.charAt(a.length-1)!=b.charAt(b.length-1))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;c<e;)a.substring(a.length-e,a.length-f)==b.substring(b.length-e,b.length-f)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e},b.prototype.diff_commonOverlap_=function(a,b){var c=a.length,d=b.length;if(c==0||d==0)return 0;c>d?a=a.substring(c-d):c<d&&(b=b.substring(0,c)),c=Math.min(c,d);if(a==b)return c;d=0;for(var e=1;;){var f=a.substring(c-e);f=b.indexOf(f);if(f==-1)return d;e+=f;if(f==0||a.substring(c-e)==b.substring(0,e))d=e,e++}},b.prototype.diff_halfMatch_=function(a,b){function c(a,b,c){for(var d=a.substring(c,c+Math.floor(a.length/4)),e=-1,g="",h,i,j,k;(e=b.indexOf(d,e+1))!=-1;){var l=f.diff_commonPrefix(a.substring(c),b.substring(e)),m=f.diff_commonSuffix(a.substring(0,c),b.substring(0,e));g.length<m+l&&(g=b.substring(e-m,e)+b.substring(e,e+l),h=a.substring(0,c-m),i=a.substring(c+l),j=b.substring(0,e-m),k=b.substring(e+l))}return g.length*2>=a.length?[h,i,j,k,g]:null}if(this.Diff_Timeout<=0)return null;var d=a.length>b.length?a:b,e=a.length>b.length?b:a;if(d.length<4||e.length*2<d.length)return null;var f=this,g=c(d,e,Math.ceil(d.length/4));d=c(d,e,Math.ceil(d.length/2));var h;if(!g&&!d)return null;h=d?g?g[4].length>d[4].length?g:d:d:g;var i;a.length>b.length?(g=h[0],d=h[1],e=h[2],i=h[3]):(e=h[0],i=h[1],g=h[2],d=h[3]),h=h[4];return[g,d,e,i,h]},b.prototype.diff_cleanupSemantic=function(a){for(var b=!1,c=[],d=0,e=null,f=0,g=0,h=0,i=0,j=0;f<a.length;)a[f][0]==0?(c[d++]=f,g=i,h=j,j=i=0,e=a[f][1]):(a[f][0]==1?i+=a[f][1].length:j+=a[f][1].length,e!==null&&e.length<=Math.max(g,h)&&e.length<=Math.max(i,j)&&(a.splice(c[d-1],0,[-1,e]),a[c[d-1]+1][0]=1,d--,d--,f=d>0?c[d-1]:-1,j=i=h=g=0,e=null,b=!0)),f++;b&&this.diff_cleanupMerge(a),this.diff_cleanupSemanticLossless(a);for(f=1;f<a.length;){if(a[f-1][0]==-1&&a[f][0]==1){b=a[f-1][1],c=a[f][1];if(d=this.diff_commonOverlap_(b,c))a.splice(f,0,[0,c.substring(0,d)]),a[f-1][1]=b.substring(0,b.length-d),a[f+1][1]=c.substring(d),f++;f++}f++}},b.prototype.diff_cleanupSemanticLossless=function(a){function b(a,b){if(!a||!b)return 5;var h=0;if(a.charAt(a.length-1).match(c)||b.charAt(0).match(c)){h++;if(a.charAt(a.length-1).match(d)||b.charAt(0).match(d)){h++;if(a.charAt(a.length-1).match(e)||b.charAt(0).match(e))h++,(a.match(f)||b.match(g))&&h++}}return h}for(var c=/[^a-zA-Z0-9]/,d=/\s/,e=/[\r\n]/,f=/\n\r?\n$/,g=/^\r?\n\r?\n/,h=1;h<a.length-1;){if(a[h-1][0]==0&&a[h+1][0]==0){var i=a[h-1][1],j=a[h][1],k=a[h+1][1],l=this.diff_commonSuffix(i,j);if(l){var m=j.substring(j.length-l);i=i.substring(0,i.length-l),j=m+j.substring(0,j.length-l),k=m+k}l=i,m=j;for(var n=k,o=b(i,j)+b(j,k);j.charAt(0)===k.charAt(0);){i+=j.charAt(0),j=j.substring(1)+k.charAt(0),k=k.substring(1);var p=b(i,j)+b(j,k);p>=o&&(o=p,l=i,m=j,n=k)}a[h-1][1]!=l&&(l?a[h-1][1]=l:(a.splice(h-1,1),h--),a[h][1]=m,n?a[h+1][1]=n:(a.splice(h+1,1),h--))}h++}},b.prototype.diff_cleanupEfficiency=function(a){for(var b=!1,c=[],d=0,e="",f=0,g=!1,h=!1,i=!1,j=!1;f<a.length;)a[f][0]==0?(a[f][1].length<this.Diff_EditCost&&(i||j)?(c[d++]=f,g=i,h=j,e=a[f][1]):(d=0,e=""),i=j=!1):(a[f][0]==-1?j=!0:i=!0,e&&(g&&h&&i&&j||e.length<this.Diff_EditCost/2&&g+h+i+j==3)&&(a.splice(c[d-1],0,[-1,e]),a[c[d-1]+1][0]=1,d--,e="",g&&h?(i=j=!0,d=0):(d--,f=d>0?c[d-1]:-1,i=j=!1),b=!0)),f++;b&&this.diff_cleanupMerge(a)},b.prototype.diff_cleanupMerge=function(a){a.push([0,""]);for(var b=0,c=0,d=0,e="",f="",g;b<a.length;)switch(a[b][0]){case 1:d++,f+=a[b][1],b++;break;case-1:c++,e+=a[b][1],b++;break;case 0:c+d>1?(c!==0&&d!==0&&(g=this.diff_commonPrefix(f,e),g!==0&&(b-c-d>0&&a[b-c-d-1][0]==0?a[b-c-d-1][1]+=f.substring(0,g):(a.splice(0,0,[0,f.substring(0,g)]),b++),f=f.substring(g),e=e.substring(g)),g=this.diff_commonSuffix(f,e),g!==0&&(a[b][1]=f.substring(f.length-g)+a[b][1],f=f.substring(0,f.length-g),e=e.substring(0,e.length-g))),c===0?a.splice(b-c-d,c+d,[1,f]):d===0?a.splice(b-c-d,c+d,[-1,e]):a.splice(b-c-d,c+d,[-1,e],[1,f]),b=b-c-d+(c?1:0)+(d?1:0)+1):b!==0&&a[b-1][0]==0?(a[b-1][1]+=a[b][1],a.splice(b,1)):b++,c=d=0,f=e=""}a[a.length-1][1]===""&&a.pop(),c=!1;for(b=1;b<a.length-1;)a[b-1][0]==0&&a[b+1][0]==0&&(a[b][1].substring(a[b][1].length-a[b-1][1].length)==a[b-1][1]?(a[b][1]=a[b-1][1]+a[b][1].substring(0,a[b][1].length-a[b-1][1].length),a[b+1][1]=a[b-1][1]+a[b+1][1],a.splice(b-1,1),c=!0):a[b][1].substring(0,a[b+1][1].length)==a[b+1][1]&&(a[b-1][1]+=a[b+1][1],a[b][1]=a[b][1].substring(a[b+1][1].length)+a[b+1][1],a.splice(b+1,1),c=!0)),b++;c&&this.diff_cleanupMerge(a)},b.prototype.diff_xIndex=function(a,b){var c=0,d=0,e=0,f=0,g;for(g=0;g<a.length;g++){a[g][0]!==1&&(c+=a[g][1].length),a[g][0]!==-1&&(d+=a[g][1].length);if(c>b)break;e=c,f=d}return a.length!=g&&a[g][0]===-1?f:f+(b-e)},b.prototype.diff_prettyHtml=function(a){for(var b=[],c=0,d=/&/g,e=/</g,f=/>/g,g=/\n/g,h=0;h<a.length;h++){var i=a[h][0],j=a[h][1],k=j.replace(d,"&amp;").replace(e,"&lt;").replace(f,"&gt;").replace(g,"&para;<br>");switch(i){case 1:b[h]='<ins style="background:#e6ffe6;">'+k+"</ins>";break;case-1:b[h]='<del style="background:#ffe6e6;">'+k+"</del>";break;case 0:b[h]="<span>"+k+"</span>"}i!==-1&&(c+=j.length)}return b.join("")},b.prototype.diff_text1=function(a){for(var b=[],c=0;c<a.length;c++)a[c][0]!==1&&(b[c]=a[c][1]);return b.join("")},b.prototype.diff_text2=function(a){for(var b=[],c=0;c<a.length;c++)a[c][0]!==-1&&(b[c]=a[c][1]);return b.join("")},b.prototype.diff_levenshtein=function(a){for(var b=0,c=0,d=0,e=0;e<a.length;e++){var f=a[e][0],g=a[e][1];switch(f){case 1:c+=g.length;break;case-1:d+=g.length;break;case 0:b+=Math.max(c,d),d=c=0}}b+=Math.max(c,d);return b},b.prototype.diff_toDelta=function(a){for(var b=[],c=0;c<a.length;c++)switch(a[c][0]){case 1:b[c]="+"+encodeURI(a[c][1]);break;case-1:b[c]="-"+a[c][1].length;break;case 0:b[c]="="+a[c][1].length}return b.join("\t").replace(/%20/g," ")},b.prototype.diff_fromDelta=function(a,b){for(var c=[],d=0,e=0,f=b.split(/\t/g),g=0;g<f.length;g++){var h=f[g].substring(1);switch(f[g].charAt(0)){case"+":try{c[d++]=[1,decodeURI(h)]}catch(i){throw Error("Illegal escape in diff_fromDelta: "+h)}break;case"-":case"=":var j=parseInt(h,10);if(isNaN(j)||j<0)throw Error("Invalid number in diff_fromDelta: "+h);h=a.substring(e,e+=j),f[g].charAt(0)=="="?c[d++]=[0,h]:c[d++]=[-1,h];break;default:if(f[g])throw Error("Invalid diff operation in diff_fromDelta: "+f[g])}}if(e!=a.length)throw Error("Delta length ("+e+") does not equal source text length ("+a.length+").");return c},b.prototype.match_main=function(a,b,c){if(a==null||b==null||c==null)throw Error("Null input. (match_main)");c=Math.max(0,Math.min(c,a.length));return a==b?0:a.length?a.substring(c,c+b.length)==b?c:this.match_bitap_(a,b,c):-1},b.prototype.match_bitap_=function(a,b,c){function d(a,d){var e=a/b.length,g=Math.abs(c-d);return f.Match_Distance?e+g/f.Match_Distance:g?1:e}if(b.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var e=this.match_alphabet_(b),f=this,g=this.Match_Threshold,h=a.indexOf(b,c);h!=-1&&(g=Math.min(d(0,h),g),h=a.lastIndexOf(b,c+b.length),h!=-1&&(g=Math.min(d(0,h),g)));var i=1<<b.length-1;h=-1;for(var j,k,l=b.length+a.length,m,n=0;n<b.length;n++){j=0;for(k=l;j<k;)d(n,c+k)<=g?j=k:l=k,k=Math.floor((l-j)/2+j);l=k,j=Math.max(1,c-k+1);var o=Math.min(c+k,a.length)+b.length;k=Array(o+2);for(k[o+1]=(1<<n)-1;o>=j;o--){var p=e[a.charAt(o-1)];k[o]=n===0?(k[o+1]<<1|1)&p:(k[o+1]<<1|1)&p|(m[o+1]|m[o])<<1|1|m[o+1];if(k[o]&i){p=d(n,o-1);if(p<=g){g=p,h=o-1;if(h>c)j=Math.max(1,2*c-h);else break}}}if(d(n+1,c)>g)break;m=k}return h},b.prototype.match_alphabet_=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=0;for(c=0;c<a.length;c++)b[a.charAt(c)]|=1<<a.length-c-1;return b},b.prototype.patch_addContext_=function(a,b){if(b.length!=0){for(var c=b.substring(a.start2,a.start2+a.length1),d=0;b.indexOf(c)!=b.lastIndexOf(c)&&c.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)d+=this.Patch_Margin,c=b.substring(a.start2-d,a.start2+a.length1+d);d+=this.Patch_Margin,(c=b.substring(a.start2-d,a.start2))&&a.diffs.unshift([0,c]),(d=b.substring(a.start2+a.length1,a.start2+a.length1+d))&&a.diffs.push([0,d]),a.start1-=c.length,a.start2-=c.length,a.length1+=c.length+d.length,a.length2+=c.length+d.length}},b.prototype.patch_make=function(a,b,d){var e;if(typeof a=="string"&&typeof b=="string"&&typeof d=="undefined")e=a,b=this.diff_main(e,b,!0),b.length>2&&(this.diff_cleanupSemantic(b),this.diff_cleanupEfficiency(b));else if(a&&typeof a=="object"&&typeof b=="undefined"&&typeof d=="undefined")b=a,e=this.diff_text1(b);else if(typeof a=="string"&&b&&typeof b=="object"&&typeof d=="undefined")e=a;else if(typeof a=="string"&&typeof b=="string"&&d&&typeof d=="object")e=a,b=d;else throw Error("Unknown call format to patch_make.");if(b.length===0)return[];d=[],a=new c;for(var f=0,g=0,h=0,i=e,j=0;j<b.length;j++){var k=b[j][0],l=b[j][1];!f&&k!==0&&(a.start1=g,a.start2=h);switch(k){case 1:a.diffs[f++]=b[j],a.length2+=l.length,e=e.substring(0,h)+l+e.substring(h);break;case-1:a.length1+=l.length,a.diffs[f++]=b[j],e=e.substring(0,h)+e.substring(h+l.length);break;case 0:l.length<=2*this.Patch_Margin&&f&&b.length!=j+1?(a.diffs[f++]=b[j],a.length1+=l.length,a.length2+=l.length):l.length>=2*this.Patch_Margin&&f&&(this.patch_addContext_(a,i),d.push(a),a=new c,f=0,i=e,g=h)}k!==1&&(g+=l.length),k!==-1&&(h+=l.length)}f&&(this.patch_addContext_(a,i),d.push(a));return d},b.prototype.patch_deepCopy=function(a){for(var b=[],d=0;d<a.length;d++){var e=a[d],f=new c;f.diffs=[];for(var g=0;g<e.diffs.length;g++)f.diffs[g]=e.diffs[g].slice();f.start1=e.start1,f.start2=e.start2,f.length1=e.length1,f.length2=e.length2,b[d]=f}return b},b.prototype.patch_apply=function(a,b){if(a.length==0)return[b,[]];a=this.patch_deepCopy(a);var c=this.patch_addPadding(a);b=c+b+c,this.patch_splitMax(a);for(var d=0,e=[],f=0;f<a.length;f++){var g=a[f].start2+d,h=this.diff_text1(a[f].diffs),i,j=-1;if(h.length>this.Match_MaxBits){i=this.match_main(b,h.substring(0,this.Match_MaxBits),g);if(i!=-1){j=this.match_main(b,h.substring(h.length-this.Match_MaxBits),g+h.length-this.Match_MaxBits);if(j==-1||i>=j)i=-1}}else i=this.match_main(b,h,g);if(i==-1)e[f]=!1,d-=a[f].length2-a[f].length1;else{e[f]=!0,d=i-g,g=j==-1?b.substring(i,i+h.length):b.substring(i,j+this.Match_MaxBits);if(h==g)b=b.substring(0,i)+this.diff_text2(a[f].diffs)+b.substring(i+h.length);else{g=this.diff_main(h,g,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(g)/h.length>this.Patch_DeleteThreshold)e[f]=!1;else{this.diff_cleanupSemanticLossless(g),h=0;var k;for(j=0;j<a[f].diffs.length;j++){var l=a[f].diffs[j];l[0]!==0&&(k=this.diff_xIndex(g,h)),l[0]===1?b=b.substring(0,i+k)+l[1]+b.substring(i+k):l[0]===-1&&(b=b.substring(0,i+k)+b.substring(i+this.diff_xIndex(g,h+l[1].length))),l[0]!==-1&&(h+=l[1].length)}}}}}b=b.substring(c.length,b.length-c.length);return[b,e]},b.prototype.patch_addPadding=function(a){for(var b=this.Patch_Margin,c="",d=1;d<=b;d++)c+=String.fromCharCode(d);for(d=0;d<a.length;d++)a[d].start1+=b,a[d].start2+=b;d=a[0];var e=d.diffs;if(e.length==0||e[0][0]!=0)e.unshift([0,c]),d.start1-=b,d.start2-=b,d.length1+=b,d.length2+=b;else if(b>e[0][1].length){var f=b-e[0][1].length;e[0][1]=c.substring(e[0][1].length)+e[0][1],d.start1-=f,d.start2-=f,d.length1+=f,d.length2+=f}d=a[a.length-1],e=d.diffs,e.length==0||e[e.length-1][0]!=0?(e.push([0,c]),d.length1+=b,d.length2+=b):b>e[e.length-1][1].length&&(f=b-e[e.length-1][1].length,e[e.length-1][1]+=c.substring(0,f),d.length1+=f,d.length2+=f);return c},b.prototype.patch_splitMax=function(a){for(var b=this.Match_MaxBits,d=0;d<a.length;d++)if(a[d].length1>b){var e=a[d];a.splice(d--,1);for(var f=e.start1,g=e.start2,h="";e.diffs.length!==0;){var i=new c,j=!0;i.start1=f-h.length,i.start2=g-h.length,h!==""&&(i.length1=i.length2=h.length,i.diffs.push([0,h]));for(;e.diffs.length!==0&&i.length1<b-this.Patch_Margin;){h=e.diffs[0][0];var k=e.diffs[0][1];h===1?(i.length2+=k.length,g+=k.length,i.diffs.push(e.diffs.shift()),j=!1):h===-1&&i.diffs.length==1&&i.diffs[0][0]==0&&k.length>2*b?(i.length1+=k.length,f+=k.length,j=!1,i.diffs.push([h,k]),e.diffs.shift()):(k=k.substring(0,b-i.length1-this.Patch_Margin),i.length1+=k.length,f+=k.length,h===0?(i.length2+=k.length,g+=k.length):j=!1,i.diffs.push([h,k]),k==e.diffs[0][1]?e.diffs.shift():e.diffs[0][1]=e.diffs[0][1].substring(k.length))}h=this.diff_text2(i.diffs),h=h.substring(h.length-this.Patch_Margin),k=this.diff_text1(e.diffs).substring(0,this.Patch_Margin),k!==""&&(i.length1+=k.length,i.length2+=k.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===0?i.diffs[i.diffs.length-1][1]+=k:i.diffs.push([0,k])),j||a.splice(++d,0,i)}}},b.prototype.patch_toText=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b.join("")},b.prototype.patch_fromText=function(a){var b=[];if(!a)return b;a=a.split("\n");for(var d=0,e=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;d<a.length;){var f=a[d].match(e);if(!f)throw Error("Invalid patch string: "+a[d]);var g=new c;b.push(g),g.start1=parseInt(f[1],10),f[2]===""?(g.start1--,g.length1=1):f[2]=="0"?g.length1=0:(g.start1--,g.length1=parseInt(f[2],10)),g.start2=parseInt(f[3],10),f[4]===""?(g.start2--,g.length2=1):f[4]=="0"?g.length2=0:(g.start2--,g.length2=parseInt(f[4],10));for(d++;d<a.length;){f=a[d].charAt(0);try{var h=decodeURI(a[d].substring(1))}catch(i){throw Error("Illegal escape in patch_fromText: "+h)}if(f=="-")g.diffs.push([-1,h]);else if(f=="+")g.diffs.push([1,h]);else if(f==" ")g.diffs.push([0,h]);else{if(f=="@")break;if(f!=="")throw Error('Invalid patch mode "'+f+'" in: '+h)}d++}}return b},c.prototype.toString=function(){var a,b;a=this.length1===0?this.start1+",0":this.length1==1?this.start1+1:this.start1+1+","+this.length1,b=this.length2===0?this.start2+",0":this.length2==1?this.start2+1:this.start2+1+","+this.length2,a=["@@ -"+a+" +"+b+" @@\n"];var c;for(b=0;b<this.diffs.length;b++){switch(this.diffs[b][0]){case 1:c="+";break;case-1:c="-";break;case 0:c=" "}a[b+1]=c+encodeURI(this.diffs[b][1])+"\n"}return a.join("").replace(/%20/g," ")},this.diff_match_patch=b,this.patch_obj=c,this.DIFF_DELETE=-1,this.DIFF_INSERT=1,this.DIFF_EQUAL=0})(typeof window!="undefined"?window:exports),function(){(function(){var a,b,c;c=typeof window!="undefined"&&window!==null?window:exports,a=typeof window!="undefined"&&window!==null?window.diff_match_patch:require(__dirname+"/diff_match_patch.js").diff_match_patch,b=new a;return c.nowpadCommon={List:function(){function a(){this.items={}}a.prototype.items={},a.prototype.length=0,a.prototype.forEach=function(a){var b,c,d,e;d=this.items,e=[];for(b in d)c=d[b],e.push(a(c));return e},a.prototype.generateId=function(){var a;for(;;){a=String(Math.floor(Math.random()*1e3));if(typeof this.items[a]=="undefined")break}return a},a.prototype.add=function(a){this.items[a.id]=a;return this.length++},a.prototype.get=function(a){return this.items[a]||!1},a.prototype.has=function(a){return this.items[a]!=null},a.prototype.set=function(a,b){if(typeof this.items[a]=="undefined")throw new Error("an item with the id of ["+a+"] does not exist");return this.items[a]=b},a.prototype.remove=function(a){var b;if(this.has(a)){b=this.get(a),delete this.items[a],this.length--;return b}return!1},a.prototype.destroy=function(a){var b;if(this.has(a)){b=this.get(a),this.remove(a);return b.destroy()}return!1};return a}(),createPatch:function(a,c){var d,e;d=b.patch_make(a,c),e=b.patch_toText(d);return e},applyPatch:function(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r;i=b.patch_fromText(a),g=!1,k={},d||(d={}),k.selectionStart=d.selectionStart||0,k.selectionEnd=d.selectionEnd||d.selectionStart,j=b.patch_apply(i,c),m=j[0],g=j[1][0]||!1;if(k.selectionStart||k.selectionEnd)for(n=0,p=i.length;n<p;n++){h=i[n],l=0,f=0,r=h.diffs;for(o=0,q=r.length;o<q;o++){e=r[o];switch(e[0]){case-1:f-=e[1].length;break;case 1:f+=e[1].length}}h.diffs[0][0]===0&&(l=h.diffs[0][1].length),l+=h.start1,l<k.selectionStart&&(k.selectionStart+=f);if(l<k.selectionStart||l<k.selectionEnd)k.selectionEnd+=f;console.log("selectionRange:",[d.selectionStart,d.selectionEnd],[k.selectionStart,k.selectionEnd],[h.start1,l,f])}return{pass:g,value:m,selectionRange:k}}}})()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};(function(){var b,c,d,e,f,g,h,i;b=g=window.jQuery,f=window.console,i=window.nowpadCommon,d=i.List;if(b.browser.msie||typeof f=="undefined"||typeof f.log=="undefined")throw Error("Your browser is not supported yet");c=function(){function a(a){this.element=a,this.elementType=function(){if(this.element.getSession!=null)return"ace";if(this.element instanceof g)return"jquery";if(this.element instanceof window.Element)return"native";throw new Error("Unknown element type")}.call(this)}a.prototype.element=null,a.prototype.elementType=null,a.prototype.value=function(a){if(a!=null)switch(this.elementType){case"ace":return this.element.getSession().setValue(a);case"jquery":return this.element.val(a);case"native":return this.element.value=a}else switch(this.elementType){case"ace":return this.element.getSession().getValue();case"jquery":return this.element.val();case"native":return this.element.value}},a.prototype.selectionRange=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(a!=null)switch(this.elementType){case"ace":n=this.element.getSession(),b=b||n.getValue(),r=b.substring(0,a.selectionStart),g=b.substring(0,a.selectionEnd),q=r.split("\n"),f=g.split("\n"),p=q.length?q.length-1:0,e=f.length?f.length-1:0,o=q[p].length,d=f[e].length;return n.selection.setSelectionRange({start:{row:p,column:o},end:{row:e,column:d}});case"jquery":c=this.element.get(0),c.selectionStart=a.selectionStart;return c.selectionEnd=a.selectionEnd;case"native":this.element.selectionStart=a.selectionStart;return this.element.selectionEnd=a.selectionEnd}else switch(this.elementType){case"ace":i=this.element.getSession().doc.getAllLines(),j=this.element.getSelectionRange(),m=0,l=0,h=0;while(h<i.length&&h<=j.end.row)h===j.start.row?m+=j.start.column:h<j.start.row&&(m+=i[h].length+1),h===j.end.row?l+=j.end.column:h<=j.end.row&&(l+=i[h].length+1),++h;return k={selectionStart:m,selectionEnd:l};case"jquery":c=this.element.get(0);return k={selectionStart:el.selectionStart,selectionEnd:el.selectionEnd};case"native":return k={selectionStart:this.element.selectionStart,selectionEnd:this.element.selectionEnd}}},a.prototype.line=function(a){if(a)switch(this.elementType){case"ace":return this.element.gotoLine(a)}},a.prototype.addClass=function(a){switch(this.elementType){case"jquery":return this.element.addClass(a)}},a.prototype.removeClass=function(a){switch(this.elementType){case"jquery":return this.element.removeClass(a)}},a.prototype.change=function(a){switch(this.elementType){case"ace":return this.element.getSession().on("change",a);case"jquery":return this.element.keyup(a);case"native":return this.element.addEventListener("change",a,!1)}};return a}(),e=function(){function b(b){var d;this.id=b.id,d=b.element,this.documentId=b.documentId,this.element=new c(d),window.now.nowpad_valueSyncDocument(this.documentId,a(function(b,c,d){this.lastCurrentValue=this.lastSyncedValue=c,this.lastSyncedState=b,this.timerDelay=d,this.element.value(c);return window.setTimeout(a(function(){return this.element.line(1)},this),500)},this)),this.element.change(a(function(){return this.resetTimer()},this))}b.prototype.id=null,b.prototype.element=null,b.prototype.documentId=null,b.prototype.lastSyncedValue="",b.prototype.lastCurrentValue="",b.prototype.lastSyncedState=!1,b.prototype.newSyncedState=!1,b.prototype.newSyncedStates=[],b.prototype.selectionRange={selectionStart:0,selectionEnd:0},b.prototype.timer=!1,b.prototype.timerDelay=200,b.prototype.isTyping=!1,b.prototype.inRequest=!1,b.prototype.timeoutDelay=1500,b.prototype.syncNotify=function(a){if(a!==this.lastSyncedState)return this.resetTimer()},b.prototype.delayNotify=function(a){if(a!==this.timerDelay)return this.timerDelay=a},b.prototype.resetTimer=function(){this.clearTimer(),this.isTyping=!0;return this.timer=window.setTimeout(a(function(){this.isTyping=!1;return this.request()},this),this.timerDelay)},b.prototype.clearTimer=function(){if(this.timer){window.clearTimeout(this.timer);return this.timer=!1}},b.prototype.request=function(){var b,c;if(!h.ready)return!1;if(this.inRequest)return!1;this.inRequest=!0,this.sync(),this.element.addClass("sync"),b=a(function(){window.now.nowpad_unlockDocument(this.documentId),this.element.removeClass("sync");return this.inRequest=!1},this),c=window.setTimeout(b,this.timeoutDelay);return window.now.nowpad_lockDocument(this.documentId,a(function(d){var e;window.clearTimeout(c);if(d){this.lastCurrentValue=this.element.value(),this.selectionRange=this.element.selectionRange(),e=i.createPatch(this.lastSyncedValue,this.lastCurrentValue),c=window.setTimeout(b,this.timeoutDelay);return window.now.nowpad_patchSyncDocument(this.documentId,this.lastSyncedState,e,a(function(a,b){clearTimeout(c),f.log("Sync response: ",{_state:b,_states:a}),a.length!==0&&(this.newSyncedStates=a,this.newSyncedState=b,this.isTyping?this.resetTimer():this.sync()),window.now.nowpad_unlockDocument(this.documentId),this.element.removeClass("sync");return this.inRequest=!1},this))}this.element.removeClass("sync"),this.inRequest=!1;return this.resetTimer()},this))},b.prototype.sync=function(){var a,b,c,d,e,g,j,k,l,m,n,o,p;if(this.newSyncedStates.length===0)return!1;a=this.lastCurrentValue,c=this.element.value(),b=this.lastSyncedState,g=this.newSyncedStates,e=this.newSyncedState,j=this.lastSyncedValue,k={selectionStart:this.selectionRange.selectionStart,selectionEnd:this.selectionRange.selectionEnd};for(o=0,p=g.length;o<p;o++)n=g[o],f.log("remote:",n),j=this.applyPatch(n,j);a&&a!==c?(n={patch:i.createPatch(a||"",c),clientId:h.clientId},f.log("local:",n),c=this.applyPatch(n,j)):c=j,this.element.value()!==c&&(d=this.element.selectionRange(),this.element.value(c),m=d.selectionStart-k.selectionStart,l=d.selectionEnd-k.selectionEnd,this.selectionRange.selectionStart+=m,this.selectionRange.selectionEnd+=l,f.log([d.selectionStart,k.selectionStart],[d.selectionEnd,k.selectionEnd],[m,l],[this.selectionRange.selectionStart,this.selectionRange.selectionEnd]),f.log("applying cursor:",this.selectionRange),this.element.selectionRange(this.selectionRange,c)),this.newSyncedStates=[],this.newSyncedState=!1,this.lastSyncedState=e,this.lastSyncedValue=j;return this.lastCurrentValue=j},b.prototype.applyPatch=function(a,b){var c,d;c=i.applyPatch(a.patch,b,this.selectionRange),d=c.value,b!==d&&a.clientId!==h.clientId?(f.log("updating cursor:",{range:this.selectionRange,valuesDifferent:b!==d,clientDifferent:a.clientId!==h.clientId}),this.selectionRange=c.selectionRange):f.log("ignored cursor:",{range:this.selectionRange,valuesDifferent:b!==d,clientDifferent:a.clientId!==h.clientId});return d};return b}(),h=window.nowpad={ready:!1,clientId:null,client:{id:null,info:{}},pads:new d,pendingInstances:[],init:function(){return window.now.ready(function(){return window.now.nowpad_handshake(function(a,b){f.log("Sync notify called: ",a,b);return h.pads.forEach(function(c){if(c.documentId===a)return c.syncNotify(b)})},function(a,b){return h.pads.forEach(function(c){if(c.documentId===a)return c.delayNotify(b)})},function(a){var b,c,d,e,f;h.clientId=a,h.ready=!0,e=h.pendingInstances,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(h.createInstance(b.config,b.callback));return f})})},createInstance:function(a,b){var c,d;if(!this.ready)return this.pendingInstances.push({config:a,callback:b});d=h.pads.generateId(),a.id=d,c=new e(a),this.pads.add(c);if(b)return b(c)}},h.init();return g.fn.nowpad=function(a){var c;c=b(this),h.createInstance({element:c,documentId:a||c.data("documentId")||"empty"});return c}})()}.call(this)